<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Language Video Call</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .video-container {
            position: relative;
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
            aspect-ratio: 16/9;
        }
        .video-container video, .video-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .user-name {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 14px;
        }
        .caption-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(245, 117, 16, 0.8);
            color: white;
            padding: 8px;
            text-align: center;
            font-weight: bold;
            display: none;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .control-btn:hover {
            transform: scale(1.1);
        }
        .control-btn.active {
            background-color: #28a745;
            color: white;
        }
        .control-btn.inactive {
            background-color: #dc3545;
            color: white;
        }
        .room-info {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 8px;
        }
        .join-form {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        #localVideo {
            transform: scaleX(-1); /* Mirror local video */
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Sign Language Video Call</h1>
        </div>

        <!-- Room creation or joining form -->
        <div id="joinForm" class="join-form">
            <h3 class="mb-4">Start or Join a Call</h3>
            <div class="mb-3">
                <button id="createRoomBtn" class="btn btn-primary w-100 mb-3">Create New Room</button>
                <div class="text-center">OR</div>
            </div>
            <div class="mb-3">
                <label for="roomIdInput" class="form-label">Enter Room Code:</label>
                <input type="text" class="form-control" id="roomIdInput" placeholder="Enter room code">
            </div>
            <div class="mb-3">
                <label for="usernameInput" class="form-label">Your Name:</label>
                <input type="text" class="form-control" id="usernameInput" placeholder="Enter your name">
            </div>
            <button id="joinRoomBtn" class="btn btn-success w-100">Join Room</button>
        </div>

        <!-- Room information -->
        <div id="roomInfo" class="room-info hidden">
            <h3>Room Code: <span id="roomIdDisplay"></span></h3>
            <p>Share this code with others to join the call</p>
        </div>

        <!-- Video grid -->
        <div id="videoGrid" class="video-grid hidden">
            <div class="video-container" id="localVideoContainer">
                <video id="localVideo" autoplay muted playsinline></video>
                <div class="user-name">You</div>
                <div class="caption-container" id="localCaption"></div>
            </div>
        </div>

        <!-- Controls -->
        <div id="controls" class="controls hidden">
            <div class="control-btn" id="toggleVideoBtn" title="Toggle Video">
                <i class="bi bi-camera-video-fill"></i>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5z"/>
                </svg>
            </div>
            <div class="control-btn" id="toggleAudioBtn" title="Toggle Audio">
                <i class="bi bi-mic-fill"></i>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z"/>
                    <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
                </svg>
            </div>
            <div class="control-btn" id="toggleSignLanguageBtn" title="Toggle Sign Language Detection">
                <i class="bi bi-translate"></i>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M4.545 6.714 4.11 8H3l1.862-5h1.284L8 8H6.833l-.435-1.286H4.545zm1.634-.736L5.5 3.956h-.049l-.679 2.022H6.18z"/>
                    <path d="M0 2a2 2 0 0 1 2-2h7a2 2 0 0 1 2 2v3h3a2 2 0 0 1 2 2v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-3H2a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H2zm7.138 9.995c.193.301.402.583.63.846-.748.575-1.673 1.001-2.768 1.292.178.217.451.635.555.867 1.125-.359 2.08-.844 2.886-1.494.777.665 1.739 1.165 2.93 1.472.133-.254.414-.673.629-.89-1.125-.253-2.057-.694-2.82-1.284.681-.747 1.222-1.651 1.621-2.757H14V8h-3v1.059c.285.784.75 1.543 1.343 2.235-.458.344-.971.636-1.53.863a8.7 8.7 0 0 1-1.675-2.163zm.63-3.727a6.17 6.17 0 0 1-1.278 1.498 8.12 8.12 0 0 1-1.283-1.498h2.561z"/>
                </svg>
            </div>
            <div class="control-btn" id="toggleLandmarksBtn" title="Toggle Landmarks Display">
                <i class="bi bi-body-text"></i>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M0 .5A.5.5 0 0 1 .5 0h4a.5.5 0 0 1 0 1h-4A.5.5 0 0 1 0 .5Zm0 2A.5.5 0 0 1 .5 2h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5Zm9 0a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm-9 2A.5.5 0 0 1 .5 4h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5Zm5 0a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm7 0a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5Zm-12 2A.5.5 0 0 1 .5 6h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5Zm8 0a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm-8 2A.5.5 0 0 1 .5 8h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5Zm7 0a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5Zm-7 2a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5Zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Z"/>
                </svg>
            </div>
            <div class="control-btn bg-danger" id="endCallBtn" title="End Call">
                <i class="bi bi-telephone-x-fill"></i>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="white" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M1.885.511a1.745 1.745 0 0 1 2.61.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>
                    <path fill-rule="evenodd" d="M11.146 1.646a.5.5 0 0 1 .708 0L13 2.793l1.146-1.147a.5.5 0 0 1 .708.708L13.707 3.5l1.147 1.146a.5.5 0 0 1-.708.708L13 4.207l-1.146 1.147a.5.5 0 0 1-.708-.708L12.293 3.5l-1.147-1.146a.5.5 0 0 1 0-.708z"/>
                </svg>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script>
        // DOM elements
        const joinForm = document.getElementById('joinForm');
        const roomInfo = document.getElementById('roomInfo');
        const videoGrid = document.getElementById('videoGrid');
        const controls = document.getElementById('controls');
        const localVideo = document.getElementById('localVideo');
        const localCaption = document.getElementById('localCaption');
        const roomIdDisplay = document.getElementById('roomIdDisplay');
        const createRoomBtn = document.getElementById('createRoomBtn');
        const joinRoomBtn = document.getElementById('joinRoomBtn');
        const roomIdInput = document.getElementById('roomIdInput');
        const usernameInput = document.getElementById('usernameInput');
        const toggleVideoBtn = document.getElementById('toggleVideoBtn');
        const toggleAudioBtn = document.getElementById('toggleAudioBtn');
        const toggleSignLanguageBtn = document.getElementById('toggleSignLanguageBtn');
        const toggleLandmarksBtn = document.getElementById('toggleLandmarksBtn');
        const endCallBtn = document.getElementById('endCallBtn');

        // Global variables
        let roomId = null;
        let userId = null;
        let username = '';
        let isHost = false;
        let localStream = null;
        let socket = null;
        let peer = null;
        let peers = {};
        let videoEnabled = true;
        let audioEnabled = true;
        let signLanguageEnabled = false;
        let showLandmarks = false;
        let frameInterval = null;
        const frameRate = 15; // Frames per second for sign language detection

        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const urlRoomId = urlParams.get('roomId');
        const urlIsHost = urlParams.get('isHost') === 'true';

        // If room ID is in URL, auto-join that room
        if (urlRoomId) {
            roomId = urlRoomId;
            isHost = urlIsHost;
            roomIdInput.value = roomId;
        }

        // Initialize
        function init() {
            // Create user ID
            userId = generateUserId();
            
            // Setup event listeners
            createRoomBtn.addEventListener('click', createRoom);
            joinRoomBtn.addEventListener('click', joinRoom);
            toggleVideoBtn.addEventListener('click', toggleVideo);
            toggleAudioBtn.addEventListener('click', toggleAudio);
            toggleSignLanguageBtn.addEventListener('click', toggleSignLanguage);
            toggleLandmarksBtn.addEventListener('click', toggleLandmarks);
            endCallBtn.addEventListener('click', endCall);

            // Apply initial UI state
            toggleVideoBtn.classList.add('active');
            toggleAudioBtn.classList.add('active');
            toggleSignLanguageBtn.classList.add('inactive');
            toggleLandmarksBtn.classList.add('inactive');
        }

        // Create a new room
        function createRoom() {
            username = usernameInput.value || 'User-' + userId.substring(0, 4);
            window.location.href = '/create-room';
        }

        // Join an existing room
        function joinRoom() {
            const inputRoomId = roomIdInput.value.trim();
            username = usernameInput.value || 'User-' + userId.substring(0, 4);
            
            if (!inputRoomId) {
                alert('Please enter a room code');
                return;
            }
            
            window.location.href = `/join-room/${inputRoomId}`;
        }

        // Start the call when page is loaded with room ID
        function startCall() {
            if (!roomId) return;
            
            // Show room UI
            joinForm.classList.add('hidden');
            roomInfo.classList.remove('hidden');
            videoGrid.classList.remove('hidden');
            controls.classList.remove('hidden');
            roomIdDisplay.textContent = roomId;
            
            // Initialize WebRTC
            initializeWebRTC();
        }

        // Initialize WebRTC
        async function initializeWebRTC() {
            try {
                // Get user media
                localStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: true
                });
                
                // Display local video
                localVideo.srcObject = localStream;
                
                // Initialize Socket.io
                socket = io();
                
                // Initialize PeerJS
                peer = new Peer(userId, {
                    host: window.location.hostname,
                    port: window.location.port || (window.location.protocol === 'https:' ? 443 : 80),
                    path: '/peerjs',
                    debug: 2
                });
                
                // PeerJS open event
                peer.on('open', (id) => {
                    console.log('My peer ID is: ' + id);
                    socket.emit('join-room', {
                        roomId: roomId,
                        userId: id,
                        username: username
                    });
                });
                
                // PeerJS call event
                peer.on('call', (call) => {
                    call.answer(localStream);
                    
                    const remoteVideo = document.createElement('video');
                    remoteVideo.setAttribute('autoplay', '');
                    remoteVideo.setAttribute('playsinline', '');
                    
                    call.on('stream', (remoteStream) => {
                        addVideoStream(call.peer, remoteStream, remoteVideo);
                    });
                    
                    call.on('close', () => {
                        removeVideoStream(call.peer);
                    });
                    
                    peers[call.peer] = call;
                });
                
                // Socket events
                socket.on('user-connected', (data) => {
                    console.log('User connected: ' + data.userId);
                    connectToNewUser(data.userId, data.username, localStream);
                });
                
                socket.on('user-disconnected', (data) => {
                    console.log('User disconnected: ' + data.userId);
                    if (peers[data.userId]) {
                        peers[data.userId].close();
                        delete peers[data.userId];
                        removeVideoStream(data.userId);
                    }
                });
                
                socket.on('existing-users', (data) => {
                    console.log('Existing users:', data.users);
                    data.users.forEach(user => {
                        connectToNewUser(user.userId, user.username, localStream);
                    });
                    
                    // Set initial state of sign language detection
                    signLanguageEnabled = data.signLanguageEnabled;
                    showLandmarks = data.showLandmarks;
                    
                    if (signLanguageEnabled) {
                        toggleSignLanguageBtn.classList.remove('inactive');
                        toggleSignLanguageBtn.classList.add('active');
                        startFrameCapture();
                    }
                    
                    if (showLandmarks) {
                        toggleLandmarksBtn.classList.remove('inactive');
                        toggleLandmarksBtn.classList.add('active');
                    }
                });
                
                socket.on('video-frame', (data) => {
                    const videoContainer = document.getElementById(`video-container-${data.userId}`);
                    if (videoContainer) {
                        const videoElement = videoContainer.querySelector('video');
                        const imgElement = videoContainer.querySelector('img') || document.createElement('img');
                        const captionElement = videoContainer.querySelector('.caption-container');
                        
                        if (!videoContainer.querySelector('img')) {
                            imgElement.style.width = '100%';
                            imgElement.style.height = '100%';
                            imgElement.style.objectFit = 'cover';
                            videoElement.style.display = 'none';
                            videoContainer.appendChild(imgElement);
                        }
                        
                        imgElement.src = data.frameData;
                        
                        if (data.caption) {
                            captionElement.textContent = data.caption;
                            captionElement.style.display = 'block';
                        } else {
                            captionElement.style.display = 'none';
                        }
                    }
                });
                
                socket.on('sign-language-toggled', (data) => {
                    signLanguageEnabled = data.enabled;
                    
                    if (signLanguageEnabled) {
                        toggleSignLanguageBtn.classList.remove('inactive');
                        toggleSignLanguageBtn.classList.add('active');
                        startFrameCapture();
                    } else {
                        toggleSignLanguageBtn.classList.remove('active');
                        toggleSignLanguageBtn.classList.add('inactive');
                        stopFrameCapture();
                        
                        // Hide all captions
                        document.querySelectorAll('.caption-container').forEach(el => {
                            el.style.display = 'none';
                        });
                        
                        // Show videos instead of processed images
                        document.querySelectorAll('.video-container').forEach(container => {
                            const video = container.querySelector('video');
                            const img = container.querySelector('img');
                            if (video && img) {
                                video.style.display = 'block';
                                img.style.display = 'none';
                            }
                        });
                    }
                });
                
                socket.on('landmarks-toggled', (data) => {
                    showLandmarks = data.show;
                    
                    if (showLandmarks) {
                        toggleLandmarksBtn.classList.remove('inactive');
                        toggleLandmarksBtn.classList.add('active');
                    } else {
                        toggleLandmarksBtn.classList.remove('active');
                        toggleLandmarksBtn.classList.add('inactive');
                    }
                });
                
                // Start frame capture if sign language is enabled
                if (signLanguageEnabled) {
                    startFrameCapture();
                }
                
            } catch (error) {
                console.error('Error initializing WebRTC:', error);
                alert('Could not access camera or microphone. Please check permissions.');
            }
        }

        // Connect to a new user
        function connectToNewUser(userId, username, stream) {
            const call = peer.call(userId, stream);
            
            const remoteVideo = document.createElement('video');
            remoteVideo.setAttribute('autoplay', '');
            remoteVideo.setAttribute('playsinline', '');
            
            call.on('stream', (remoteStream) => {
                addVideoStream(userId, remoteStream, remoteVideo, username);
            });
            
            call.on('close', () => {
                removeVideoStream(userId);
            });
            
            peers[userId] = call;
        }

        // Add a video stream to the grid
        function addVideoStream(userId, stream, videoElement, username = 'User') {
            // Check if container already exists
            let videoContainer = document.getElementById(`video-container-${userId}`);
            
            if (!videoContainer) {
                videoContainer = document.createElement('div');
                videoContainer.id = `video-container-${userId}`;
                videoContainer.className = 'video-container';
                
                const usernameElement = document.createElement('div');
                usernameElement.className = 'user-name';
                usernameElement.textContent = username;
                
                const captionElement = document.createElement('div');
                captionElement.className = 'caption-container';
                captionElement.id = `caption-${userId}`;
                
                videoContainer.appendChild(videoElement);
                videoContainer.appendChild(usernameElement);
                videoContainer.appendChild(captionElement);
                
                videoGrid.appendChild(videoContainer);
            }
            
            videoElement.srcObject = stream;
        }

        // Remove a video stream from the grid
        function removeVideoStream(userId) {
            const videoContainer = document.getElementById(`video-container-${userId}`);
            if (videoContainer) {
                videoGrid.removeChild(videoContainer);
            }
        }

        // Toggle video
        function toggleVideo() {
            if (localStream) {
                const videoTrack = localStream.getVideoTracks()[0];
                if (videoTrack) {
                    videoEnabled = !videoEnabled;
                    videoTrack.enabled = videoEnabled;
                    
                    if (videoEnabled) {
                        toggleVideoBtn.classList.remove('inactive');
                        toggleVideoBtn.classList.add('active');
                    } else {
                        toggleVideoBtn.classList.remove('active');
                        toggleVideoBtn.classList.add('inactive');
                    }
                }
            }
        }

        // Toggle audio
        function toggleAudio() {
            if (localStream) {
                const audioTrack = localStream.getAudioTracks()[0];
                if (audioTrack) {
                    audioEnabled = !audioEnabled;
                    audioTrack.enabled = audioEnabled;
                    
                    if (audioEnabled) {
                        toggleAudioBtn.classList.remove('inactive');
                        toggleAudioBtn.classList.add('active');
                    } else {
                        toggleAudioBtn.classList.remove('active');
                        toggleAudioBtn.classList.add('inactive');
                    }
                }
            }
        }

        // Toggle sign language detection
        function toggleSignLanguage() {
            signLanguageEnabled = !signLanguageEnabled;
            
            if (socket) {
                socket.emit('toggle-sign-language', {
                    roomId: roomId,
                    enabled: signLanguageEnabled
                });
            }
            
            if (signLanguageEnabled) {
                toggleSignLanguageBtn.classList.remove('inactive');
                toggleSignLanguageBtn.classList.add('active');
                startFrameCapture();
            } else {
                toggleSignLanguageBtn.classList.remove('active');
                toggleSignLanguageBtn.classList.add('inactive');
                stopFrameCapture();
            }
        }

        // Toggle landmarks display
        function toggleLandmarks() {
            showLandmarks = !showLandmarks;
            
            if (socket) {
                socket.emit('toggle-landmarks', {
                    roomId: roomId,
                    show: showLandmarks
                });
            }
            
            if (showLandmarks) {
                toggleLandmarksBtn.classList.remove('inactive');
                toggleLandmarksBtn.classList.add('active');
            } else {
                toggleLandmarksBtn.classList.remove('active');
                toggleLandmarksBtn.classList.add('inactive');
            }
        }

        // Start capturing frames for sign language detection
        function startFrameCapture() {
            if (frameInterval) return;
            
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            frameInterval = setInterval(() => {
                if (!localStream || !signLanguageEnabled) return;
                
                const videoTrack = localStream.getVideoTracks()[0];
                if (!videoTrack || !videoTrack.enabled) return;
                
                // Set canvas dimensions to match video
                canvas.width = localVideo.videoWidth;
                canvas.height = localVideo.videoHeight;
                
                // Draw video frame to canvas
                context.drawImage(localVideo, 0, 0, canvas.width, canvas.height);
                
                // Convert canvas to base64 image
                const frameData = canvas.toDataURL('image/jpeg', 0.8);
                
                // Send frame to server for processing
                if (socket) {
                    socket.emit('video-frame', {
                        roomId: roomId,
                        userId: userId,
                        frameData: frameData
                    });
                }
            }, 1000 / frameRate);
        }

        // Stop capturing frames
        function stopFrameCapture() {
            if (frameInterval) {
                clearInterval(frameInterval);
                frameInterval = null;
            }
        }

        // End the call
        function endCall() {
            if (confirm('Are you sure you want to end the call?')) {
                // Close all peer connections
                for (let userId in peers) {
                    peers[userId].close();
                }
                
                // Stop local stream
                if (localStream) {
                    localStream.getTracks().forEach(track => track.stop());
                }
                
                // Stop frame capture
                stopFrameCapture();
                
                // Disconnect socket
                if (socket) {
                    socket.disconnect();
                }
                
                // Redirect to home
                window.location.href = '/';
            }
        }

        // Generate a random user ID
        function generateUserId() {
            return 'user-' + Math.random().toString(36).substring(2, 15);
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            init();
            
            // If room ID is in URL, start the call
            if (roomId) {
                startCall();
            }
        });
    </script>
</body>
</html>